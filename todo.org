#+title: Todo

* [ ] General
** [X] Add TUI message plumbing to UIServer
** [X] Add state to UIServer - first message sent to idle state should start the workflow
** [X] Stream log messages/errors to client. Figure out general startup sequencing and error handling.
** [X] Fix logging - have a special buffer and a way to see logs at will
** [X] Rethink tool step handling. Make it easier for UI to understand the tool execution state
** [X] Create Step renderer in TUI client
** [X] Add input request stack to TUI
** [X] Set input header depending on the top of the input stack
** [X] Fix APPROVE/DECLINE rendering
** [X] Do not pad lines with spaces - it breaks copy-paste
** [ ] Add history editing mode
*** [ ] Stopped runner getting a text message is resumed and last user input is replaced with whatever it typed
*** [ ] Add a away to visually select previous continuation point
** [ ] Fix knowlt summary documentation generation - it adds python docstring twice
** [ ] Add a way for knowlt to return individual symbols from file by id. have compact ids, not uuids.
** [ ] Implement tool call formatters
** [X] LLM usage stats
*** [X] Per-node reporting (current limits)
*** [X] Per-session accumulation
*** [X] Display in the toolbar
** [?] Child runner support
*** [X] Base implementation
*** [ ] Stopping child runner and resuming
** [ ] Add context compression? How?
** [ ] Continue after stop needs explicit separator.
** [ ] Show node transitions in the UI?
** [ ] Add node visible flag - some are technical and should be hidden from the UI/autocompletion
* [ ] Runner
** [X] Add is_complete to Step to differentiate between intermediate and final results
** [X] Add tool support by checking if complete step was received and it contains tool calls
** [X] Create a separate BaseModel for runner generator responses, do not use Step. Convert response to a step.
** [X] Tool rejection might include a message - pass that as a tool response
** [ ] Correctly handle incorrect response to PROMPT
** [X] Extend PROMPT Step to have mode (message, approval, etc)
* [X] Migrate tools
* [X] Migrate nodes
* [ ] UI
** [ ] Rethink TUIState
- Right now heavily dependent on a bunch of callbacks passed from App
- Limited APIs possible
- Consolidate APIs into interface?
** [X] Create an in-memory bidirectional communication channel
** [X] History support
- on_history_up, on_history_down events
- history in UIState
- on_submit in UIState forwarded to app.py
** [X] Command handler
** [X] Auto-complete support
** [X] Add toolbar component under input
*** [X] Add execution status + animation
** [X] Add animation for different tool call statuses and indicators (approved, canceled, etc)
** [ ] Hide tool approved events 
** [ ] TUI library
*** [X] Refactor apply_style
*** [X] Add on_cancel (esc) to SelectList event. Figure out how to handle esc, as it is conflicts with special sequences
*** [X] Remove padding from SelectList
*** [X] Add animation support, potentially via Rich Live
*** [ ] Add optimization to not re-render unchanged lines after top-level component if height did not change. Figure out generic algorithm.
*** [X] Fix up TUI tests - need to run Rich in non-terminal mode
* [ ] LLM Node
** [ ] Require outcome to be provided and loop until it is provided
* [ ] Tools
** [X] Refactor tool registration
** [ ] Simplify error reporting for v4a patch tool
* [ ] Log management
** [ ] Store run sessions
** [X] Store UI sessions?
