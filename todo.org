#+title: Todo

* [ ] General
** [ ] Optimize Terminal renderer
- Do not force re-render when component is added or removed:
  - when remove_component is called, we need to add it to a new set of deleted components and mark as dirty.
  - when re-render happens, in incremental render we need to take deleted component into account and skip it when walking backwards. this should happen automatically, as deleted components will be in the list during the walk and they should have cached lines.
  - after stopping the walk, we need to remove all deleted components from the _components before getting tail components and then empty the deleted components set.
  - if there are no tail components to render - we're done.
  - otherwise render forward as usual.
  - make minimal changes, create helpers as needed.
  - adjust existing tests that rely on full re-render when components are deleted.
 
  this should fix the rendering when component is removed and incremental render is called. we should be conservative and prefer incremental renders whenever possible.
** [ ] Collapse/expand to work with visible components first, then continue going backwards. Keep track of updated components to resume from.
** [ ] Add sync exception handler and send it to the log
** [ ] Add session log renderer as a separate screen + shortcut
** [ ] Need to remove outline from input - it messes up copying
** [ ] Measure and report time it took to run the step at the step bottom.
- Figure out a way to add component under last message and skip it when adding a new step message
** [ ] Add /reset command
** [ ] Test multi-screen paste
*** [ ] Handle paste without showing whole content
** [ ] Add a way for knowlt to return individual symbols from file by id.
** [ ] Add collapse/expand for components
*** [ ] Add default setting into node for collapse status and lines.
** [ ] Add input shotcut manager
*** [ ] Keybindings in configuration
*** [ ] Mapping to commands
** [ ] Change auto-complete protocol to also send back cursor position with list of complete options
*** [ ] Do client-side validation or hide auto-complete if user keeps typing
** [ ] Continue after stop needs explicit separator.
** [ ] Show node transitions in the UI?
** [X] Add node visible flag - some are technical and should be hidden from the UI/autocompletion
** [ ] Gemini 3 support
*** [ ] Temperature control
** [ ] Add ctrl+r history search
** [ ] Add context compression? How?
* [ ] Settings
** [ ] Tweak templated nodes
** [ ] Create correct initial templates for chat, coder, architect and agent.
* [ ] Runner
** [ ] Correctly handle incorrect response to PROMPT
* [ ] UI
** [ ] Rethink TUIState
- Right now heavily dependent on a bunch of callbacks passed from App
- Limited APIs possible
- Consolidate APIs into interface?
** [ ] Hide tool approved events 
** [ ] TUI library
*** [ ] Add optimization to not re-render unchanged lines after top-level component if height did not change. Figure out generic algorithm. Useful for animations.
*** [X] Fix up TUI tests - need to run Rich in non-terminal mode
* [ ] LLM Node
** [ ] Require outcome to be provided and loop until it is provided
* [ ] Tools
** [ ] Simplify error reporting for v4a patch tool
* [ ] System prompts
** [ ] Discovery
*** [ ] Gemini does not use search for some reason, steer towards search
* [ ] Tools
** [ ] Delayed execution tool + executor
* [ ] Session management
** [ ] Branch current session from a specific message
** [ ] Load session from the disk
** [ ] Store session inputs in a metadat file and show them as a summary
