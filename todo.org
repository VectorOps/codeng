#+title: Todo

* [ ] General
** [ ] If tool call is just approved, do not generate component with "User approved." text.
** [ ] Update task list error needs to be formatted (or not displayed)
** [ ] Add dynamic progress indicator for knowlt
** [ ] Investigate lag when sending first input message
** [ ] Remove extra line break from task tool
** [ ] Add dynamic variable support that's calculated at runtime
*** [ ] Add a way to change variable setting via TUI
- List variables
- Add variable types with lookup manager (LLM models, etc)
- Pick from the list vs type it in
** [ ] Non-interactive mode
*** [ ] Accept workflow to run via commandline parameter
*** [ ] Implement TUI that's pipe compatible (rich should support)
*** [ ] Fail if user wants a confirmation in non-interactive mode
** [ ] Fix up logging
*** [ ] LiteLLM critical errors should be intercepted and displayed via existing rendering machinery
** [ ] Come up with a plugin architecture for LLM authentication logic (OAuth2, etc)
** [ ] Tool call rejection with the message needs format
** [ ] Add commands to tool approval that change behavior (auto-approve tool for this session, etc)
** [ ] Know: rename read_files to read_file
** [ ] Auto-complete
*** [ ] Space with selection should auto-complete
** [ ] Send LLM stats when executor starts (from old state?)
** [ ] Store cached stats in LLM usage stats
** [ ] Create alternative Markdown renderer that only highlights, but does not format
** [ ] Need apply_patch formatter with input and output (collapsed)
** [ ] Assign a number to collapse/expand a specific component and show number in the component view. (bad idea due to repaints?)
** [ ] Compact tool call representation, where consequent calls are merged onto a single.
** [ ] Hide time indicator for tool calls - it is not helpful
** [ ] Limit number of lines actually rendered for full refreshes, make the number configurable
** [ ] Combine input + toolbar + help + etc to a single component due to dynamic component shifting
- Move stacking logic out of TUIState
- Move keyboard logic out of TUIState
** [ ] Figure out how to support parallel nested workflows:
- Remove the single workflow stack or refactor it to contain a list of runners instead of one 
- Figure out how to drive multiple parallel workflow tasks. Multiple coordinators? Single awaitable for results? 
- Figure out how does this change data model (if at all) 
- Figure out how this affects the UI - just change confirmations to be displayed from child workflow and change toolbar around that time?
** [ ] Figure out how to show input/http_input nodes as a user input (highlight, etc)
** [ ] Figure out why http_input intemediate message is not overridden by new text
- Rework intermediate messages to be complete and not deltas?
** [?] Fix tall input component logic
*** [ ] If input component is scrolling, show percentage in padding
** [ ] Autocomplete
*** [ ] Figure out why auto-complete might return same file multiple times
** [ ] Add sync exception handler and send it to the log
** [ ] Add session log renderer as a separate screen + shortcut
** [ ] Need to remove outline from input - it messes up copying
** [ ] Measure and report time it took to run the step at the step bottom.
- Figure out a way to add component under last message and skip it when adding a new step message
** [X] Add /reset command
** [ ] Test multi-screen paste
*** [ ] Handle paste without showing whole content
** [ ] Add a way for knowlt to return individual symbols from file by id.
** [ ] Add collapse/expand for components
*** [ ] Add default setting into node for collapse status and lines.
** [ ] Add input shotcut manager
*** [ ] Keybindings in configuration
*** [ ] Mapping to commands
** [ ] Change auto-complete protocol to also send back cursor position with list of complete options
*** [ ] Do client-side validation or hide auto-complete if user keeps typing
** [ ] Continue after stop needs explicit separator.
** [ ] Show node transitions in the UI?
** [ ] Gemini 3 support
*** [ ] Temperature control
** [ ] Add ctrl+r history search
** [ ] Add context compression? How?
** [ ] Collapse/expand to work with visible components first, then continue going backwards. Keep track of updated components to resume from.
* [ ] Settings
** [ ] Tweak templated nodes
** [ ] Create correct initial templates for chat, coder, architect and agent.
* [ ] Runner
** [ ] Correctly handle incorrect response to PROMPT
* [ ] UI
*** [ ] Rethink TUIState
- Right now heavily dependent on a bunch of callbacks passed from App
- Limited APIs possible
- Consolidate APIs into interface?
** [ ] Hide tool approved events 
** [ ] TUI library
*** [ ] Add optimization to not re-render unchanged lines after top-level component if height did not change. Figure out generic algorithm. Useful for animations.
*** [X] Fix up TUI tests - need to run Rich in non-terminal mode
* [ ] LLM Node
** [ ] Require outcome to be provided and loop until it is provided
* [ ] Tools
** [ ] Simplify error reporting for v4a patch tool
* [ ] System prompts
** [ ] Discovery
*** [ ] Gemini does not use search for some reason, steer towards search
* [ ] Tools
** [ ] Delayed execution tool + executor
* [ ] Session management
** [ ] Branch current session from a specific message
** [ ] Load session from the disk
** [ ] Store session inputs in a metadat file and show them as a summary
* [ ] Patchers
** [ ] More strict V4A parser
*** [ ] Prevent partial updates?
** [ ] Nudge patch format to provide multiple patches in single roundtrip to save on tokens
* [ ] Know
** [ ] C parser
** [ ] C++ parser
** [ ] Add extensions to parsers (.h -> cpp or to c, etc)
* [ ] Worktree support
** [ ] Extend know to support worktree
*** [ ] Worktrees table and nullable worktree_id to all tables
*** [ ] Accept worktree_id filter and do read-through
*** [ ] Scanning to be updated to support worktree_id
*** [ ] Quick deletion of worktree related data
** [ ] Add support for worktree_id to project, runner, etc
